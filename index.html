<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ðŸ¦Š Kitsune Paste â€” Completo</title>
<style>
  :root {
    --bg: #0b0e0f;
    --panel: #0f1515;
    --muted: #98a3a3;
    --accent: #2dd36f;
    --danger: #ff6b6b;
    --glass: rgba(255, 255, 255, 0.03);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system,
      "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    min-height: 100vh;
    background: var(--bg);
    color: #dfeeea;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  .wrap {
    max-width: 1100px;
    margin: 28px auto;
    padding: 20px;
    display: grid;
    grid-template-columns: 420px 1fr;
    gap: 18px;
  }
  .card {
    background: var(--panel);
    border-radius: 10px;
    padding: 16px;
    box-shadow: 0 6px 30px rgba(2, 6, 6, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.05);
    display: flex;
    flex-direction: column;
  }
  header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }
  .logo {
    width: 48px;
    height: 48px;
    border-radius: 10px;
    background: linear-gradient(135deg, #0f6, #2dd36f);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: #022;
    user-select: none;
    font-size: 30px;
  }
  h1 {
    font-size: 20px;
    margin: 0;
  }
  p.lead {
    margin: 0;
    color: var(--muted);
    font-size: 14px;
  }
  label {
    display: block;
    font-size: 13px;
    margin: 14px 0 6px;
    color: var(--muted);
    user-select: none;
  }
  input[type="text"],
  select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.07);
    background: var(--bg);
    color: inherit;
    outline: none;
    font-size: 14px;
  }
  textarea {
    width: 100%;
    min-height: 400px;
    resize: vertical;
    padding: 12px;
    border-radius: 10px;
    background: var(--bg);
    border: 1px solid rgba(255, 255, 255, 0.05);
    color: #dff7ea;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
    font-size: 13px;
    line-height: 1.4;
    white-space: pre-wrap;
    overflow-wrap: break-word;
  }
  .actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 14px;
  }
  button {
    padding: 10px 14px;
    border-radius: 8px;
    border: none;
    background: var(--glass);
    color: var(--muted);
    cursor: pointer;
    font-size: 14px;
    user-select: none;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  button:hover {
    background: var(--accent);
    color: #022;
  }
  button.primary {
    background: linear-gradient(90deg, var(--accent), #25b964);
    color: #022;
    font-weight: 600;
  }
  button.primary:hover {
    background: #22cc57;
    color: #011;
  }
  button.ghost {
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.05);
  }
  button.ghost:hover {
    background: var(--accent);
    color: #022;
    border-color: var(--accent);
  }
  button.warn {
    background: linear-gradient(90deg, var(--danger), #ff4b4b);
    color: #111;
  }
  button.warn:hover {
    background: #ff3a3a;
    color: #222;
  }
  .preview {
    padding: 12px;
    border-radius: 8px;
    height: 500px;
    overflow: auto;
    background: var(--panel);
    border: 1px solid rgba(255, 255, 255, 0.04);
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
    font-size: 13px;
    white-space: pre-wrap;
    word-break: break-word;
    user-select: text;
  }
  pre {
    margin: 0;
  }
  .meta {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
    user-select: none;
  }
  .small {
    font-size: 12px;
    color: var(--muted);
  }
  .badge {
    background: rgba(0, 0, 0, 0.25);
    padding: 6px 10px;
    border-radius: 999px;
    font-weight: 600;
  }
  @media (max-width: 980px) {
    .wrap {
      grid-template-columns: 1fr;
      padding: 12px;
    }
    .preview {
      height: 320px;
    }
  }
</style>
</head>
<body>
  <div class="wrap">
    <section class="card" aria-label="Editor de cÃ³digo">
      <header>
        <div class="logo" aria-label="Logo Kitsune Paste">ðŸ¦Š</div>
        <div>
          <h1>ðŸ¦Š Kitsune Paste â€” Completo</h1>
          <p class="lead">Cole seu cÃ³digo, escolha linguagem e compartilhe via URL (hash).</p>
        </div>
      </header>

      <label for="title">TÃ­tulo (opcional)</label>
      <input id="title" type="text" placeholder="TÃ­tulo do paste" autocomplete="off" />

      <label for="lang">Linguagem</label>
      <select id="lang" aria-label="Selecionar linguagem">
        <option value="auto">Detectar / Texto</option>
        <option value="javascript">JavaScript</option>
        <option value="lua">Lua</option>
        <option value="python">Python</option>
        <option value="html">HTML</option>
        <option value="css">CSS</option>
        <option value="bash">Bash</option>
        <option value="json">JSON</option>
        <option value="text">Texto</option>
      </select>

      <label for="expansion">Salvar localmente?</label>
      <select id="expansion" aria-label="Salvar localmente">
        <option value="none">NÃ£o</option>
        <option value="local">Sim (localStorage)</option>
      </select>

      <label for="editor">ConteÃºdo do cÃ³digo</label>
      <textarea id="editor" placeholder="// Cole seu cÃ³digo aqui..."></textarea>

      <div class="actions">
        <button class="primary" id="saveBtn" type="button" title="Salvar & gerar link (hash)">Salvar & Gerar Link</button>
        <button id="rawBtn" class="ghost" type="button" title="Abrir conteÃºdo RAW em nova aba">Abrir RAW</button>
        <button id="copyBtn" type="button" title="Copiar para Ã¡rea de transferÃªncia">Copiar</button>
        <button id="downloadBtn" type="button" title="Download do arquivo">Download</button>
        <button id="clearBtn" class="warn" type="button" title="Limpar tudo">Limpar</button>
        <button id="themeBtn" class="ghost" type="button" title="Alternar tema claro/escuro" style="margin-left:auto;">Alternar Tema</button>
      </div>
    </section>

    <section class="card" aria-label="Visualizador do cÃ³digo">
      <div class="meta">
        <div>
          <span class="badge" id="badgeLang">Texto</span>
          <span class="small" id="pasteTitle">â€”</span>
        </div>
        <div class="small" id="hashInfo">URL: â€”</div>
      </div>

      <pre class="preview" id="preview" tabindex="0" aria-live="polite" aria-atomic="true"></pre>
    </section>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const editor = $("editor");
  const preview = $("preview");
  const badgeLang = $("badgeLang");
  const pasteTitle = $("pasteTitle");
  const hashInfo = $("hashInfo");
  const langSelect = $("lang");
  const titleInput = $("title");
  const expansionSelect = $("expansion");
  const saveBtn = $("saveBtn");
  const rawBtn = $("rawBtn");
  const copyBtn = $("copyBtn");
  const downloadBtn = $("downloadBtn");
  const clearBtn = $("clearBtn");
  const themeBtn = $("themeBtn");

  // Base64 encode/decode UTF-8 safe
  function b64enc(str) {
    return btoa(unescape(encodeURIComponent(str)));
  }
  function b64dec(str) {
    try {
      return decodeURIComponent(escape(atob(str)));
    } catch {
      return null;
    }
  }

  // Atualiza hash com dados (tÃ­tulo, lang, content)
  function setHash(data) {
    const json = JSON.stringify(data);
    const encoded = b64enc(json);
    location.hash = encoded;
    updateHashInfo();
  }

  // LÃª dados da hash da URL
  function getHashData() {
    if (!location.hash) return null;
    const hash = location.hash.substring(1);
    const json = b64dec(hash);
    if (!json) return null;
    try {
      return JSON.parse(json);
    } catch {
      return null;
    }
  }

  // Atualiza info da hash na UI
  function updateHashInfo() {
    if (location.hash) {
      const short = location.hash.substring(1, 9);
      hashInfo.textContent = "hash: #" + short + " â€¢ Compartilhe a URL para acessar";
    } else {
      hashInfo.textContent = "URL: â€”";
    }
  }

  // Detecta linguagem bÃ¡sica para o badge e preview simples
  function detectLang(text) {
    const t = text.slice(0, 2000).toLowerCase();
    if (t.includes("<?php") || /<\s*html/.test(t)) return "html";
    if (/\bfunction\b/.test(t) && /=>/.test(t)) return "javascript";
    if (/\b(local|function|end)\b/.test(t)) return "lua";
    if (/\b(def|elif|import|from)\b/.test(t)) return "python";
    if (t.trim().startsWith("{") && /:\s*["'{\[]?/.test(t)) return "json";
    if (t.includes("{") && t.includes("}")) return "css";
    return "text";
  }

  // Atualiza preview e badge sem alterar texto original
  function updatePreview() {
    const lang = langSelect.value === "auto" ? detectLang(editor.value) : langSelect.value;
    badgeLang.textContent = lang;
    pasteTitle.textContent = titleInput.value || "â€”";
    // Preview com escape para mostrar texto original puro
    preview.textContent = editor.value || "Cole ou gere um paste para visualizar aqui...";
  }

  // Copia conteÃºdo original para clipboard
  async function copyToClipboard() {
    try {
      await navigator.clipboard.writeText(editor.value);
      alert("ConteÃºdo copiado para a Ã¡rea de transferÃªncia!");
    } catch {
      prompt("Copie manualmente:", editor.value);
    }
  }

  // Faz download do arquivo
  function downloadFile(filename, content) {
    const blob = new Blob([content], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 0);
  }

  // Carrega dados nos inputs
  function loadData(data) {
    if (!data) return;
    titleInput.value = data.title || "";
    langSelect.value = data.lang || "auto";
    editor.value = data.content || "";
    updatePreview();
  }

  // Salva local no localStorage
  function saveLocal() {
    if (expansionSelect.value !== "local") {
      localStorage.removeItem("kitsune_paste");
      return;
    }
    const data = {
      title: titleInput.value,
      lang: langSelect.value,
      content: editor.value,
    };
    localStorage.setItem("kitsune_paste", JSON.stringify(data));
  }

  // Carrega local do localStorage
  function loadLocal() {
    const raw = localStorage.getItem("kitsune_paste");
    if (!raw) return null;
    try {
      return JSON.parse(raw);
    } catch {
      return null;
    }
  }

  // Alterna tema
  function toggleTheme() {
    const root = document.documentElement;
    const isDark = root.style.getPropertyValue("--bg") === "#0b0e0f" || !root.style.getPropertyValue("--bg");
    if (isDark) {
      root.style.setProperty("--bg", "#fff");
      root.style.setProperty("--panel", "#f0f0f0");
      root.style.setProperty("--muted", "#666");
      root.style.setProperty("--accent", "#2dd36f");
      root.style.setProperty("--danger", "#ff6b6b");
      root.style.setProperty("--glass", "rgba(0,0,0,0.05)");
      document.body.style.color = "#222";
    } else {
      root.style.setProperty("--bg", "#0b0e0f");
      root.style.setProperty("--panel", "#0f1515");
      root.style.setProperty("--muted", "#98a3a3");
      root.style.setProperty("--accent", "#2dd36f");
      root.style.setProperty("--danger", "#ff6b6b");
      root.style.setProperty("--glass", "rgba(255,255,255,0.03)");
      document.body.style.color = "#dfeeea";
    }
  }

  // Atualiza preview e salva local ao digitar/mudar
  editor.addEventListener("input", () => {
    updatePreview();
    saveLocal();
  });
  titleInput.addEventListener("input", () => {
    updatePreview();
    saveLocal();
  });
  langSelect.addEventListener("change", () => {
    updatePreview();
    saveLocal();
  });
  expansionSelect.addEventListener("change", () => {
    saveLocal();
  });

  // BotÃµes
  saveBtn.addEventListener("click", () => {
    const data = {
      title: titleInput.value,
      lang: langSelect.value,
      content: editor.value,
    };
    setHash(data);
    alert("Link gerado! Copie a URL para compartilhar.");
  });

  rawBtn.addEventListener("click", () => {
    // Abre o conteÃºdo puro em uma nova aba
    const blob = new Blob([editor.value], { type: "text/plain" });
    const url = URL.createObjectURL(blob);
    window.open(url, "_blank");
  });

  copyBtn.addEventListener("click", () => {
    copyToClipboard();
  });

  downloadBtn.addEventListener("click", () => {
    let ext = "txt";
    switch (langSelect.value) {
      case "javascript":
        ext = "js";
        break;
      case "lua":
        ext = "lua";
        break;
      case "python":
        ext = "py";
        break;
      case "html":
        ext = "html";
        break;
      case "css":
        ext = "css";
        break;
      case "bash":
        ext = "sh";
        break;
      case "json":
        ext = "json";
        break;
    }
    const filename = (titleInput.value.trim() || "paste") + "." + ext;
    downloadFile(filename, editor.value);
  });

  clearBtn.addEventListener("click", () => {
    if (!confirm("Tem certeza que deseja limpar todo o conteÃºdo?")) return;
    titleInput.value = "";
    langSelect.value = "auto";
    expansionSelect.value = "none";
    editor.value = "";
    updatePreview();
    localStorage.removeItem("kitsune_paste");
    location.hash = "";
    updateHashInfo();
  });

  themeBtn.addEventListener("click", () => {
    toggleTheme();
  });

  // Carrega dados da URL e localStorage no carregamento
  window.addEventListener("load", () => {
    // Carrega do hash primeiro
    const data = getHashData();
    if (data) {
      loadData(data);
    } else {
      // Se nÃ£o, carrega localStorage
      const localData = loadLocal();
      if (localData) {
        loadData(localData);
      }
    }
    updateHashInfo();
  });

  // Atualiza preview inicial
  updatePreview();

  // Atualiza hashInfo se mudar a hash manualmente
  window.addEventListener("hashchange", () => {
    const data = getHashData();
    if (data) loadData(data);
    updateHashInfo();
  });
})();
</script>
</body>
</html>
